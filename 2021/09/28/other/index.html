<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="其他知识 本篇文章包含了 vue源码知识  和  其他特色功能展示 vue源码部分核心解析  由于是单独提取需要上下相互学习 初始化data   new Vue的时候调用会调用_init方法,定义 $set、 $get 、$delete、$watch 等方法,调用$mount进行页面的挂载,挂载的时候主要是通过mountComponent方法,定义updateComponent更新函数,执行ren">
<meta property="og:type" content="article">
<meta property="og:title" content="其他知识">
<meta property="og:url" content="http://example.com/2021/09/28/other/index.html">
<meta property="og:site_name" content="周贺涛的博客">
<meta property="og:description" content="其他知识 本篇文章包含了 vue源码知识  和  其他特色功能展示 vue源码部分核心解析  由于是单独提取需要上下相互学习 初始化data   new Vue的时候调用会调用_init方法,定义 $set、 $get 、$delete、$watch 等方法,调用$mount进行页面的挂载,挂载的时候主要是通过mountComponent方法,定义updateComponent更新函数,执行ren">
<meta property="og:locale">
<meta property="article:published_time" content="2021-09-28T04:23:48.000Z">
<meta property="article:modified_time" content="2023-04-25T01:19:01.855Z">
<meta name="twitter:card" content="summary">


<title >其他知识</title>

<!-- Favicon -->

    <link href='/favicon-16x16.png?v=2.0.4' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/favicon-32x32.png?v=2.0.4' rel='icon' type='image/png' sizes='32x32' ></link>


    <link href='/apple-touch-icon.png?v=2.0.4' rel='apple-touch-icon' sizes='180x180' ></link>


    <link href='/site.webmanifest' rel='manifest' ></link>


<!-- Plugin -->




    
<link rel="stylesheet" href="/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"example.com","author":null,"root":"/","typed_text":null,"theme_version":"2.0.4","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"https://img2.baidu.com/it/u=3425801665,2370274849&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500","icon16":"favicon-16x16.png","icon32":"favicon-32x32.png","appleTouchIcon":"apple-touch-icon.png","webmanifest":"/site.webmanifest","visibilitychange":true,"hidden":"failure.ico","showText":"(/≧▽≦/)咦！又好了！","hideText":"(●—●)喔哟，崩溃啦！"},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）","author":"本文作者：","copyright_link":"本文链接：","copyright_license_title":"版权声明：","copyright_license_content":"本博客所有文章除特别声明外，均默认采用 undefined 许可协议。","copy_success":"复制成功","copy_failure":"复制失败","open_read_mode":"进入阅读模式","exit_read_mode":"退出阅读模式","notice_outdate_message":"距离上次更新已经 undefined 天了, 文章内容可能已经过时。","just":"刚刚","min":"分钟前","hour":"小时前","day":"天前","month":"个月前"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","user_tag":"fas fa-user-alt","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":true,"title":"default","height_limit":200},"creative_commons":{"license":"by-nc-sa","language":"deed.zh"},"search":{"enable":true,"type":"local","href":"https://www.google.com/search?q=site:","domain":"www.hetao.asia","path":"search.xml"}};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2023-04-25 09:19:01"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/css/index.css?v=2.0.4" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->
 
<meta name="generator" content="Hexo 6.3.0"></head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" data-scroll-container style="opacity: 0">
          <div data-scroll-section id="content" class="trm-scroll-section">

            <div class="locomotive-scroll__sticky-target" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;"></div>

            <!-- top bar -->
            <header class="trm-top-bar" data-scroll data-scroll-sticky data-scroll-target=".locomotive-scroll__sticky-target" data-scroll-offset="-10">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<a href="/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="https://img2.baidu.com/it/u=3425801665,2370274849&fm=253&fmt=auto&app=138&f=JPEG?w=500&h=500">
    
    
        <div class="trm-logo-text">
            WEB<span>周</span>
        </div>
    
</a>
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/" target="">
                    首页
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/archives/" target="">
                    归档
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
    
    <div id="trm-search-btn" class="trm-search-btn">
        <i class="iconfont fas fa-search"></i>
    </div>
     

		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner" data-scroll data-scroll-direction="vertical">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" data-scroll data-scroll-direction="vertical" data-scroll-speed="-3" src="https://pic1.zhimg.com/v2-b3c2c6745b9421a13a3c4706b19223b3_r.jpg">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container" data-scroll data-scroll-direction="vertical" data-scroll-speed="0">
            <div class="row">
                
                <div class="col-lg-4"></div>
                
                <div class="col-lg-8">

                    <!-- banner title -->
                    <div class="trm-banner-text ">
                        <div class="trm-label trm-mb-20">
                            Hi my new friend!
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            其他知识
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2021
                                    </span
                                ></li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <a href="#about-triger" data-scroll-to="#about-triger" data-scroll-offset="-130" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </a>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
                <div id="page-sidebar" class="col-lg-4 hidden-sm">
                    <!-- main card -->
                    

<div class="trm-main-card-frame trm-sidebar">
    <div class="trm-main-card" data-scroll data-scroll-repeat data-scroll-sticky data-scroll-target=".locomotive-scroll__sticky-target" data-scroll-offset="60"> 
    
        <div class="trm-user-tabs" id="sidebar-tabs">
           <div class="trm-tabs-nav trm-mb-40" id="trm-tabs-nav">
                <div data-to="tabs-user" class="trm-tabs-nav-item">
                    <i class="iconfont fas fa-user-alt"></i>
                </div>
                <div data-to="tabs-toc" class="trm-tabs-nav-item active">
                    <i class="iconfont fas fa-th-list"></i>
                </div>
           </div>
            <div name="tabs-user" class="trm-tabs-item">
                <!-- card header -->
<div class="trm-mc-header">
    <div class="trm-avatar-frame trm-mb-20">
        <img alt="Avatar" class="trm-avatar" src="/img/avatar.jpg">
    </div>
    <h5 class="trm-name trm-mb-15">
        周子谦的博客
    </h5>
    
</div>
<!-- card header end -->
                <!-- sidebar social -->

<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<div class="trm-social">
    
        <a href="https://github.com/zhou-ziqian/zhou-ziqian.github.io" title="github" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-github"></i>
        </a>
    
        <a href="https://gitee.com" title="gitee" rel="nofollow" target="_blank">
            <i class="iconfont iconfont cg-gitee"></i>
        </a>
    
</div>

<!-- sidebar social end -->
                <!-- info -->
<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<ul class="trm-table trm-mb-20">
    
        <li>
            <div class="trm-label">
                地址:
            </div>
            <div class="trm-label trm-label-light">
                北京昌平
            </div>
        </li>
    
        <li>
            <div class="trm-label">
                年龄:
            </div>
            <div class="trm-label trm-label-light">
                22
            </div>
        </li>
    
</ul>
<!-- info end -->

                
    <div class="trm-divider trm-mb-40 trm-mt-40"></div>
    <!-- action button -->
    <div class="text-center">
        <a href="mailto:admin@imalun.com" class="trm-btn">
            联系我
            <i class="iconfont far fa-envelope"></i>
        </a>
    </div>
    <!-- action button end -->

            </div>
            <div name="tabs-toc" class="trm-tabs-item active">
                <div class="post-toc">
    <ol class="toc"><li class="toc-item toc-level-2"><a rel="nofollow" class="toc-link" href="#其他知识"  data-scroll-to="#其他知识"><span class="toc-number">1.</span> <span class="toc-text">其他知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a rel="nofollow" class="toc-link" href="#vue源码部分核心解析"  data-scroll-to="#vue源码部分核心解析"><span class="toc-number">1.1.</span> <span class="toc-text">vue源码部分核心解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#初始化data"  data-scroll-to="#初始化data"><span class="toc-number">1.1.1.</span> <span class="toc-text">初始化data</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#初始化init"  data-scroll-to="#初始化init"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">初始化init</span></a></li><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#初始化状态"  data-scroll-to="#初始化状态"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">初始化状态</span></a></li></ol></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#vue中的data"  data-scroll-to="#vue中的data"><span class="toc-number">1.1.2.</span> <span class="toc-text">vue中的data</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#data-中处理对象数组"  data-scroll-to="#data-中处理对象数组"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">data 中处理对象数组</span></a></li><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#data-中处理数组"  data-scroll-to="#data-中处理数组"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">data 中处理数组</span></a></li></ol></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#vue模板编译"  data-scroll-to="#vue模板编译"><span class="toc-number">1.1.3.</span> <span class="toc-text">vue模板编译</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#获取html转为ast语法"  data-scroll-to="#获取html转为ast语法"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">获取html转为ast语法</span></a></li><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#ast语法变为render函数"  data-scroll-to="#ast语法变为render函数"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">ast语法变为render函数</span></a></li><li class="toc-item toc-level-5"><a rel="nofollow" class="toc-link" href="#render字符串从函数到dom"  data-scroll-to="#render字符串从函数到dom"><span class="toc-number">1.1.3.3.</span> <span class="toc-text">render字符串从函数到dom</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a rel="nofollow" class="toc-link" href="#diff算法"  data-scroll-to="#diff算法"><span class="toc-number">1.2.</span> <span class="toc-text">diff算法</span></a></li><li class="toc-item toc-level-3"><a rel="nofollow" class="toc-link" href="#vue中的双向数据绑定"  data-scroll-to="#vue中的双向数据绑定"><span class="toc-number">1.3.</span> <span class="toc-text">vue中的双向数据绑定</span></a></li><li class="toc-item toc-level-3"><a rel="nofollow" class="toc-link" href="#js运行机制"  data-scroll-to="#js运行机制"><span class="toc-number">1.4.</span> <span class="toc-text">js运行机制</span></a></li><li class="toc-item toc-level-3"><a rel="nofollow" class="toc-link" href="#浏览器跨域原理"  data-scroll-to="#浏览器跨域原理"><span class="toc-number">1.5.</span> <span class="toc-text">浏览器跨域原理</span></a></li><li class="toc-item toc-level-3"><a rel="nofollow" class="toc-link" href="#实用方法"  data-scroll-to="#实用方法"><span class="toc-number">1.6.</span> <span class="toc-text">实用方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#复制文本到切板"  data-scroll-to="#复制文本到切板"><span class="toc-number">1.6.1.</span> <span class="toc-text">复制文本到切板</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#获取某个日期相当于当年的第几天"  data-scroll-to="#获取某个日期相当于当年的第几天"><span class="toc-number">1.6.2.</span> <span class="toc-text">获取某个日期相当于当年的第几天</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#解析url参数"  data-scroll-to="#解析url参数"><span class="toc-number">1.6.3.</span> <span class="toc-text">解析url参数</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#生成随机颜色"  data-scroll-to="#生成随机颜色"><span class="toc-number">1.6.4.</span> <span class="toc-text">生成随机颜色</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#去掉字符串中的元素标记"  data-scroll-to="#去掉字符串中的元素标记"><span class="toc-number">1.6.5.</span> <span class="toc-text">去掉字符串中的元素标记</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#反转字符串"  data-scroll-to="#反转字符串"><span class="toc-number">1.6.6.</span> <span class="toc-text">反转字符串</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#获取两个数字之间的随机数"  data-scroll-to="#获取两个数字之间的随机数"><span class="toc-number">1.6.7.</span> <span class="toc-text">获取两个数字之间的随机数</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#检查日期是否合法"  data-scroll-to="#检查日期是否合法"><span class="toc-number">1.6.8.</span> <span class="toc-text">检查日期是否合法</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#检查日期是否在两个日期之间"  data-scroll-to="#检查日期是否在两个日期之间"><span class="toc-number">1.6.9.</span> <span class="toc-text">检查日期是否在两个日期之间</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#判断此页面标签是否激活"  data-scroll-to="#判断此页面标签是否激活"><span class="toc-number">1.6.10.</span> <span class="toc-text">判断此页面标签是否激活</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#判断一段字符串是否是url"  data-scroll-to="#判断一段字符串是否是url"><span class="toc-number">1.6.11.</span> <span class="toc-text">判断一段字符串是否是url</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#打乱数组顺序"  data-scroll-to="#打乱数组顺序"><span class="toc-number">1.6.12.</span> <span class="toc-text">打乱数组顺序</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#去除数字之外的所有字符"  data-scroll-to="#去除数字之外的所有字符"><span class="toc-number">1.6.13.</span> <span class="toc-text">去除数字之外的所有字符</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#删除数组重复项"  data-scroll-to="#删除数组重复项"><span class="toc-number">1.6.14.</span> <span class="toc-text">删除数组重复项</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#过滤数组为false得值"  data-scroll-to="#过滤数组为false得值"><span class="toc-number">1.6.15.</span> <span class="toc-text">过滤数组为false得值</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#滚动到页面顶部"  data-scroll-to="#滚动到页面顶部"><span class="toc-number">1.6.16.</span> <span class="toc-text">滚动到页面顶部</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#滚动到页面底部"  data-scroll-to="#滚动到页面底部"><span class="toc-number">1.6.17.</span> <span class="toc-text">滚动到页面底部</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#调用摄像头"  data-scroll-to="#调用摄像头"><span class="toc-number">1.6.18.</span> <span class="toc-text">调用摄像头</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#y隐藏手机号中间四位"  data-scroll-to="#y隐藏手机号中间四位"><span class="toc-number">1.6.19.</span> <span class="toc-text">y隐藏手机号中间四位</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#禁止浏览器缩放"  data-scroll-to="#禁止浏览器缩放"><span class="toc-number">1.6.20.</span> <span class="toc-text">禁止浏览器缩放</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#vue自定义拖拽指令"  data-scroll-to="#vue自定义拖拽指令"><span class="toc-number">1.6.21.</span> <span class="toc-text">vue自定义拖拽指令</span></a></li><li class="toc-item toc-level-4"><a rel="nofollow" class="toc-link" href="#调用摄像头-1"  data-scroll-to="#调用摄像头-1"><span class="toc-number">1.6.22.</span> <span class="toc-text">调用摄像头</span></a></li></ol></li></ol></li></ol>
</div>
            </div>
        </div>
    
    </div>
</div>
                    <!-- main card end -->
                </div>
            
            <div id="page-content" class="col-lg-8">
                <div class="trm-content" id="trm-content">
                    <div data-scroll data-scroll-repeat data-scroll-offset="500" id="about-triger"></div>

                    <div id="post-info" class="row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            09/28
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            12:23
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
    <h2 id="其他知识"><a href="#其他知识" class="headerlink" title="其他知识"></a>其他知识</h2><p> 本篇文章包含了 vue源码知识  和  其他特色功能展示</p>
<h3 id="vue源码部分核心解析"><a href="#vue源码部分核心解析" class="headerlink" title="vue源码部分核心解析"></a>vue源码部分核心解析</h3><p>  由于是单独提取需要上下相互学习</p>
<h4 id="初始化data"><a href="#初始化data" class="headerlink" title="初始化data"></a>初始化data</h4><p>   new Vue的时候调用会调用_init方法,定义 $set、 $get 、$delete、$watch 等方法,调用$mount进行页面的挂载,挂载的时候主要是通过mountComponent方法,定义updateComponent更新函数,执行render生成虚拟DOM,_update将虚拟DOM生成真实DOM结构，并且渲染到页面中<br>   <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">//html</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">        <span class="attr">el</span>:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">        <span class="comment">//data  两种情况</span></span><br><span class="line">        <span class="attr">data</span>:&#123;</span><br><span class="line"></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="title function_">data</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">msg</span>:<span class="string">&quot;hello&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="attr">watch</span>:&#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//.$mount(&quot;#app&quot;)</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">vue</span>(<span class="params">options</span>)&#123;</span><br><span class="line">    <span class="comment">//初始化</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">_init</span>(options)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">initMixin</span>(vue)</span><br><span class="line"><span class="title function_">lifeyvleMinin</span>(vue)<span class="comment">//添加生命周期</span></span><br><span class="line"><span class="title function_">renderMin</span>(<span class="title class_">Vue</span>)<span class="comment">//添加_rende</span></span><br><span class="line"><span class="comment">//全局方法</span></span><br><span class="line"><span class="title function_">initGlobApi</span>(<span class="title class_">Vue</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> vue</span><br><span class="line"></span><br></pre></td></tr></table></figure></p>
<h5 id="初始化init"><a href="#初始化init" class="headerlink" title="初始化init"></a>初始化init</h5> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initMixin</span>(<span class="params">Vue</span>)&#123;</span><br><span class="line">   <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span>(<span class="params">options</span>)&#123;</span><br><span class="line">     <span class="keyword">let</span> vm  = <span class="variable language_">this</span>  <span class="comment">//vm = 实例</span></span><br><span class="line">     vm.<span class="property">$options</span> = <span class="title function_">merfeOptions</span>(<span class="title class_">Vue</span>.<span class="property">options</span>,options)</span><br><span class="line">     <span class="title function_">callHook</span>(vm,<span class="string">&#x27;beforeCreates&#x27;</span>)</span><br><span class="line">     <span class="comment">//生命周期</span></span><br><span class="line">     vm.<span class="property">$options</span> = <span class="title function_">mergerOption</span>(<span class="title class_">Vue</span>.<span class="property">options</span>)</span><br><span class="line">     <span class="comment">//初始化状态</span></span><br><span class="line">     <span class="title function_">initState</span>(vm)</span><br><span class="line">     <span class="title function_">callHook</span>(vm,;<span class="string">&#x27;creates&#x27;</span>)</span><br><span class="line"></span><br><span class="line">     <span class="comment">//渲染模板</span></span><br><span class="line">     <span class="keyword">if</span>(vm.<span class="property">$options</span>.<span class="property">el</span>)&#123;</span><br><span class="line">        vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>)</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//创建$mount</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span>(<span class="params">el</span>)&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">let</span> vm = <span class="variable language_">this</span> <span class="comment">//实例</span></span><br><span class="line">    el = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(el)</span><br><span class="line">    <span class="keyword">let</span> options = vm.<span class="property">$options</span></span><br><span class="line">    <span class="keyword">if</span>(!options.<span class="property">render</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> template= options.<span class="property">template</span></span><br><span class="line">        <span class="keyword">if</span>(!template &amp;&amp; el)&#123;</span><br><span class="line">            <span class="comment">//获取到html</span></span><br><span class="line">    el=el.<span class="property">outerHTML</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="初始化状态"><a href="#初始化状态" class="headerlink" title="初始化状态"></a>初始化状态</h5> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initState</span>(<span class="params">vm</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> ops = vm.<span class="property">$options</span></span><br><span class="line">    <span class="comment">//判断</span></span><br><span class="line">    <span class="keyword">if</span>(opts.<span class="property">props</span>)&#123;</span><br><span class="line">        <span class="title function_">initProps</span>(vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(opts.<span class="property">data</span>)&#123;</span><br><span class="line">        <span class="title function_">initData</span>(vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(opts.<span class="property">watch</span>)&#123;</span><br><span class="line">        <span class="title function_">initWatch</span>(vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(opts.<span class="property">compoted</span>)&#123;</span><br><span class="line">        <span class="title function_">initCompoted</span>(vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(opts.<span class="property">methods</span>)&#123;</span><br><span class="line">        <span class="title function_">initMethods</span>(vm)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initProps</span>(<span class="params">vm</span>)&#123;&#125;</span><br><span class="line"><span class="comment">//vue2对data初始化   //分为函数 和对象  两种类型</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initData</span>(<span class="params">vm</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> data = vm.<span class="property">$options</span>.<span class="property">data</span></span><br><span class="line">    <span class="comment">//this  指向window   要指向new实例</span></span><br><span class="line">    data = <span class="keyword">typeof</span> data == <span class="string">&#x27;function&#x27;</span>? data.<span class="title function_">call</span>(vm):data</span><br><span class="line">     <span class="comment">//劫持data</span></span><br><span class="line">    <span class="title function_">observer</span>(data)</span><br><span class="line">    <span class="comment">//data中的数据分为   数组(内部包含对象)  和对象两种情况</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initWatch</span>(<span class="params">vm</span>)&#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initCompoted</span>(<span class="params">vm</span>)&#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initMethods</span>(<span class="params">vm</span>)&#123;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="vue中的data"><a href="#vue中的data" class="headerlink" title="vue中的data"></a>vue中的data</h4><p> data分为两种形式  分为函数和对象    在远吗中通过typeof  判断是函数还是对象 将返回的结果传递给了observer函数进行类型判断取值<br>是把传入值所有的属性(包括嵌套属性)递归 进行响应式defineReactive，又通过 object.definProperty（缺点：  对象中的一个属性进行劫持）   定义get  set方法<br>难点是对数组的劫持  首先对数组进行遍历 并获取数组原来的方法  并继承 然后对数组中所有能改变数组自身的方法，如 push、pop 等这些方法进行重写。重写后的方法会先执行它们本身原有的逻辑，并对能增加数组长度的 3 个方法 push、unshift、splice 方法做了判断，获取到插入的值，然后把新添加的值变成一个响应式对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = vm.<span class="property">$options</span>.<span class="property">data</span></span><br><span class="line">data = <span class="keyword">typeof</span> data === <span class="string">&#x27;function&#x27;</span>?data.<span class="title function_">call</span>(vm):data</span><br><span class="line"><span class="title function_">observer</span>(data)<span class="comment">//劫持data  对象/数组</span></span><br></pre></td></tr></table></figure>
<h5 id="data-中处理对象数组"><a href="#data-中处理对象数组" class="headerlink" title="data 中处理对象数组"></a>data 中处理对象数组</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">data</span>)&#123;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断数据</span></span><br><span class="line">  <span class="keyword">if</span>(typeod data != <span class="string">&#x27;object&#x27;</span> || data == <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> data</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//对象通过一个类劫持</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Observer</span>(data)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value</span>)&#123;</span><br><span class="line">      <span class="comment">//给value定义了一个属性</span></span><br><span class="line">      <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(value,<span class="string">&quot;__ob__&quot;</span>,&#123;</span><br><span class="line">      <span class="attr">enumerable</span>:<span class="literal">false</span>,</span><br><span class="line">      <span class="attr">value</span>:<span class="variable language_">this</span></span><br><span class="line">  &#125;)</span><br><span class="line">      <span class="comment">//判断数据</span></span><br><span class="line">      <span class="keyword">if</span>(<span class="title class_">Array</span>.<span class="title function_">isArray</span>(value))&#123;</span><br><span class="line">           value.<span class="property">__proto__</span> == <span class="title class_">ArrayMethods</span></span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">observeArray</span>(value)<span class="comment">//处理数组对象</span></span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="variable language_">this</span>.<span class="title function_">walk</span>(value)   <span class="comment">//遍历  </span></span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">data</span>)&#123;</span><br><span class="line">      <span class="keyword">let</span> keys = object.<span class="title function_">keys</span>(data)</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;keys.<span class="property">length</span>;i++)&#123;</span><br><span class="line">          <span class="comment">//对我们的每个属性进行劫持</span></span><br><span class="line">          <span class="keyword">let</span> key =keys[i]</span><br><span class="line">          <span class="keyword">let</span> value = data[i]</span><br><span class="line">          <span class="title function_">defineReactive</span>(data,key,value)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">observeArray</span>(<span class="params">value</span>)&#123;</span><br><span class="line">      <span class="keyword">for</span>(<span class="keyword">let</span> <span class="keyword">let</span> i=<span class="number">0</span>;i&lt;value.<span class="property">length</span>;i++)&#123;</span><br><span class="line">          <span class="title function_">observer</span>(value[i])</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//对对象中的属性进行劫持</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">definReactive</span>(<span class="params">data,key,value</span>)&#123;</span><br><span class="line">      <span class="title function_">observer</span>(value)<span class="comment">//深度代理</span></span><br><span class="line"></span><br><span class="line">    object.<span class="title function_">definProperty</span>(data,key,&#123;</span><br><span class="line">      <span class="title function_">get</span>(<span class="params"></span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> data[key]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="title function_">set</span>(<span class="params">newValue</span>)&#123;</span><br><span class="line">          <span class="keyword">if</span>(newValue == value) <span class="keyword">return</span> ;</span><br><span class="line">             <span class="title function_">observer</span>(value)<span class="comment">//如果用户设置的是对象</span></span><br><span class="line">          value = newValue</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="data-中处理数组"><a href="#data-中处理数组" class="headerlink" title="data 中处理数组"></a>data 中处理数组</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数组劫持    方法函数劫持  劫持数组方法</span></span><br><span class="line"><span class="comment">//重写数组</span></span><br><span class="line"><span class="comment">//1.获取原来数组方法</span></span><br><span class="line"><span class="keyword">let</span>  oldArrayProtoMethods = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span></span><br><span class="line"><span class="comment">//2.继承</span></span><br><span class="line"><span class="keyword">export</span>  <span class="keyword">let</span> <span class="title class_">ArrayMethods</span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(oldArrayProtoMethods)</span><br><span class="line"><span class="comment">//3.劫持</span></span><br><span class="line"><span class="keyword">let</span> methods = [</span><br><span class="line">    <span class="string">&#x27;push&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;pop&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;unshift&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;shift&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;splice&#x27;</span></span><br><span class="line">]</span><br><span class="line">methods.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="title class_">ArrayMethods</span>[item] = <span class="keyword">function</span>(<span class="params">...args</span>)&#123;</span><br><span class="line">       <span class="keyword">let</span> result =  oldArrayProtoMethods[item].<span class="title function_">apply</span>(<span class="variable language_">this</span>,args)</span><br><span class="line">       <span class="comment">//问题   数组追加对象的情况 要进行劫持</span></span><br><span class="line">      <span class="keyword">let</span> inserted</span><br><span class="line">      <span class="title class_">Switch</span>(item)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">        <span class="keyword">case</span><span class="string">&#x27;unshift&#x27;</span>:</span><br><span class="line">        inserted = args</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;splice&#x27;</span>:</span><br><span class="line">            inserted = args.<span class="title function_">splice</span>()</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">let</span> ob = <span class="variable language_">this</span>.<span class="property">__ob__</span></span><br><span class="line">       <span class="keyword">if</span>(inserted)&#123;</span><br><span class="line">        ob.<span class="title function_">observeArray</span>(inserted)</span><br><span class="line">       &#125;</span><br><span class="line">     <span class="keyword">return</span> result</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="vue模板编译"><a href="#vue模板编译" class="headerlink" title="vue模板编译"></a>vue模板编译</h4><p>创建了一个baseCompile 函数 通过document.querySelector获取到html  通过正则解析  将template模板里面属性 指定等等 解析成ast树 并进行遍历 节点进行标记  生成render函数 render函数将模版内容生成对应的vnode 通过diff算法中的patch 等到渲染视图中的vnode  新旧节点的对比  创建真实的dom节点插入视图中完成渲染<br>*&#x2F;</p>
<h5 id="获取html转为ast语法"><a href="#获取html转为ast语法" class="headerlink" title="获取html转为ast语法"></a>获取html转为ast语法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line">/vue首次渲染 =&gt;&gt;  先初始化数据 =》  讲模板进行编译</span><br><span class="line">  <span class="comment">//创建$mount</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">initMixin</span>(<span class="params">Vue</span>)&#123;</span><br><span class="line">   <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_init</span> = <span class="keyword">function</span>(<span class="params">options</span>)&#123;</span><br><span class="line">     <span class="keyword">let</span> vm  = <span class="variable language_">this</span>  <span class="comment">//vm = 实例</span></span><br><span class="line">     vm.<span class="property">$options</span> = options</span><br><span class="line">     <span class="comment">//初始化状态</span></span><br><span class="line">     <span class="title function_">initState</span>(vm)</span><br><span class="line">     <span class="comment">//渲染模板</span></span><br><span class="line">     <span class="keyword">if</span>(vm.<span class="property">$options</span>.<span class="property">el</span>)&#123;</span><br><span class="line">        vm.$mount(vm.<span class="property">$options</span>.<span class="property">el</span>)</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//创建$mount</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">$mount</span> = <span class="keyword">function</span>(<span class="params">el</span>)&#123;</span><br><span class="line">    <span class="comment">// </span></span><br><span class="line">    <span class="keyword">let</span> vm = <span class="variable language_">this</span> <span class="comment">//实例</span></span><br><span class="line">    el = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(el)</span><br><span class="line">    <span class="keyword">let</span> options = vm.<span class="property">$options</span></span><br><span class="line">    <span class="keyword">if</span>(!options.<span class="property">render</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> template= options.<span class="property">template</span></span><br><span class="line">        <span class="keyword">if</span>(!template &amp;&amp; el)&#123;</span><br><span class="line">            <span class="comment">//获取到html</span></span><br><span class="line">           el=el.<span class="property">outerHTML</span></span><br><span class="line">           <span class="comment">//变成ast语法树</span></span><br><span class="line">           <span class="keyword">let</span> ast = <span class="title function_">compileToFunction</span>(el)</span><br><span class="line">           <span class="comment">//变成rander()</span></span><br><span class="line">           options.<span class="property">render</span> = render</span><br><span class="line">           <span class="comment">//变成虚拟dom</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//挂载组件</span></span><br><span class="line">    <span class="title function_">mounetComponent</span>(<span class="params">vm,el</span>)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">///ast语法树&#123;&#125;  vnode只能操作节点</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;div id=&quot;app&quot;&gt;hello &#123;&#123;msg&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="comment"> &#123;</span></span><br><span class="line"><span class="comment">  tag:&#x27;div&#x27;,</span></span><br><span class="line"><span class="comment">  attrs:[&#123;id:&quot;#app&quot;&#125;],</span></span><br><span class="line"><span class="comment">  children:[&#123;tag:&quot;&quot;,text:&quot;hello&quot;,&#125;,&#123;tag:&#x27;div&#x27;.......&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="keyword">const</span> ncname = <span class="string">`[a-zA-Z_][\\-\\..-9_a-zA-Z]*`</span>;</span><br><span class="line"><span class="keyword">const</span> qunameCapture = <span class="string">`((?:<span class="subst">$&#123;ncname&#125;</span>\\:)?<span class="subst">$&#123;ncnme&#125;</span>)`</span>;</span><br><span class="line"><span class="keyword">const</span> startTagOpen = <span class="keyword">new</span> <span class="title class_">RegEp</span>(<span class="string">`^&lt;<span class="subst">$&#123;quameCapture&#125;</span>`</span>);</span><br><span class="line"><span class="keyword">const</span> endTag = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`^&lt;\\/<span class="subst">$&#123;qnameCapture&#125;</span>[^&gt;]*&gt;`</span>);</span><br><span class="line"><span class="keyword">const</span> attribute = <span class="regexp">/^\s*([^\s&quot;&#x27;&lt;&gt;\/=]+)(?:\s*(=)\s*(?:&quot;([^&quot;]*)&quot;+|&#x27;([^&#x27;]*)&#x27;+|([^\s &quot;&#x27;=&lt;&gt;` ]+)))?/</span>;</span><br><span class="line"><span class="comment">//&lt;div id=&#x27;app&#x27;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="keyword">const</span> startTagClose = <span class="regexp">/^\s*(/</span>\?)&gt;/;</span><br><span class="line"><span class="keyword">const</span> defaultTagRE = <span class="regexp">/\&#123;\((?:.|\r?\n)+?)\&#125;/g</span></span><br><span class="line"><span class="comment">//创建一个ast对象</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createAstElement</span>(<span class="params">tag,attrs</span>)&#123;</span><br><span class="line">   <span class="keyword">return</span> &#123;</span><br><span class="line">       tagName,<span class="comment">//元素</span></span><br><span class="line">       attrs,<span class="comment">//属性</span></span><br><span class="line">       <span class="attr">children</span>:[]<span class="comment">//子节点</span></span><br><span class="line">       <span class="attr">type</span>:<span class="number">1</span>,</span><br><span class="line">       <span class="attr">parent</span>:<span class="literal">null</span><span class="comment">//</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> root;<span class="comment">//根元素</span></span><br><span class="line"><span class="keyword">let</span> creatParent;<span class="comment">//当前元素的父级</span></span><br><span class="line"><span class="comment">//  数据结构    栈</span></span><br><span class="line"><span class="keyword">let</span> stack = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">start</span>(<span class="params">tag,attrs</span>)&#123;<span class="comment">//开始标签</span></span><br><span class="line">  <span class="keyword">let</span> element  = <span class="title function_">createAstElement</span>(tag,attrs)</span><br><span class="line">  <span class="keyword">if</span>(!root)&#123;</span><br><span class="line">    root = element</span><br><span class="line">  &#125;</span><br><span class="line">  creatParent = element</span><br><span class="line">  stack.<span class="title function_">push</span>(element)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">charts</span>(<span class="params">text</span>)&#123;<span class="comment">//获取文本</span></span><br><span class="line">     text= text.<span class="title function_">replace</span>(<span class="regexp">/a/g</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">     <span class="keyword">if</span>(text)&#123;</span><br><span class="line">      createParent.<span class="property">children</span>.<span class="title function_">push</span>(&#123;<span class="attr">type</span>:<span class="number">3</span>,text&#125;)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">end</span>(<span class="params"></span>)&#123;</span><br><span class="line">   <span class="keyword">let</span> element = stack.<span class="title function_">pop</span>()</span><br><span class="line">   creatParent = stack[stack.<span class="property">length</span>-<span class="number">1</span>]</span><br><span class="line">   <span class="keyword">if</span>(creatParent)&#123;<span class="comment">//元素的闭合</span></span><br><span class="line">       element.<span class="property">parent</span>.<span class="property">creaateParent</span>.<span class="property">tag</span></span><br><span class="line">       creaateParent.<span class="property">children</span>.<span class="title function_">push</span>(element)</span><br><span class="line"></span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseHTML</span>(<span class="params">html</span>)&#123;</span><br><span class="line">   <span class="keyword">while</span>(html)&#123;   <span class="comment">//html  为空时候结束</span></span><br><span class="line">     <span class="comment">//判断标签</span></span><br><span class="line">     <span class="keyword">let</span> textEnd = html.<span class="title function_">indexOf</span>(<span class="string">&#x27;&lt;&#x27;</span>) <span class="comment">//</span></span><br><span class="line">     <span class="keyword">if</span>(textEnd === <span class="number">0</span>)&#123;</span><br><span class="line">      <span class="comment">//第一种情况    开始标签</span></span><br><span class="line">      <span class="keyword">const</span> startTagMatch = <span class="title function_">parseStartTag</span>()<span class="comment">//开始标签内容</span></span><br><span class="line">      <span class="keyword">if</span>(startTagMatch)&#123;</span><br><span class="line">          <span class="title function_">start</span>(startTagMatch.<span class="property">tagName</span>,startTagMatch.<span class="property">attrs</span>)</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">//结束标签</span></span><br><span class="line">      <span class="keyword">let</span> endTagMatch = html.<span class="title function_">match</span>(endTag)</span><br><span class="line">      <span class="keyword">if</span>(endTagMatch)&#123;</span><br><span class="line">        <span class="title function_">advance</span>(endTagMatch[<span class="number">0</span>].<span class="property">length</span>)</span><br><span class="line">          <span class="title function_">end</span>(endTagMatch[<span class="number">1</span>])</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> text</span><br><span class="line">     <span class="comment">//文本</span></span><br><span class="line">     <span class="keyword">if</span>(textEnd&gt;<span class="number">0</span>)&#123;</span><br><span class="line">      <span class="comment">//获取文本内容</span></span><br><span class="line">      text = html.<span class="title function_">substring</span>(<span class="number">0</span>,textEnd)</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span>(text)&#123;</span><br><span class="line">      <span class="title function_">advance</span>(text.<span class="property">length</span>)</span><br><span class="line">      <span class="title function_">charts</span>(text)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">function</span> <span class="title function_">parseStartTag</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//解析开始标签</span></span><br><span class="line">    <span class="keyword">const</span> start = html.<span class="title function_">match</span>(startTagOpen) <span class="comment">//1.结果 2.false</span></span><br><span class="line">    <span class="keyword">if</span>(start)&#123;</span><br><span class="line">      <span class="comment">//创建ast   语法树</span></span><br><span class="line">    <span class="keyword">let</span> match = &#123;</span><br><span class="line">      <span class="attr">tagName</span>:start[<span class="number">1</span>],</span><br><span class="line">      <span class="attr">attrs</span>:[],</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="title function_">advance</span>(stsrt[<span class="number">0</span>].<span class="property">length</span>)</span><br><span class="line">          </span><br><span class="line">    <span class="comment">//删除开始标签</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//属性  多个属性</span></span><br><span class="line">    <span class="keyword">let</span> attr</span><br><span class="line">    <span class="keyword">let</span> end </span><br><span class="line">    <span class="keyword">while</span>((!end = html.<span class="title function_">match</span>(startTagClose)) &amp;&amp; (attrs=html.<span class="title function_">match</span>(attribute)))&#123;</span><br><span class="line">      march.<span class="property">attrs</span>.<span class="title function_">push</span>(&#123;<span class="attr">name</span>:attr[<span class="number">1</span>],<span class="attr">vale</span>:attrs[<span class="number">3</span>]||attrs[<span class="number">4</span>]||attrs[<span class="number">3</span>]&#125;)</span><br><span class="line">      <span class="title function_">advance</span>(attr[<span class="number">0</span>])</span><br><span class="line">      brack;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(end) &#123;</span><br><span class="line">       <span class="title function_">advance</span>(end[<span class="number">0</span>].<span class="property">length</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">function</span> <span class="title function_">advance</span>(<span class="params">n</span>)&#123; </span><br><span class="line">   html =  html.<span class="title function_">substring</span>(n)</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">compileToFunction</span>(<span class="params">el</span>)&#123;</span><br><span class="line"> <span class="keyword">let</span> ast=  <span class="title function_">parseHTML</span>(el)</span><br><span class="line"> <span class="comment">//ast   语法树变成 render函数  1.ast语法树  变成字符串  2.字符串变成函数</span></span><br><span class="line">   <span class="keyword">let</span> code =<span class="title function_">generate</span>(ast)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ast语法变为render函数"><a href="#ast语法变为render函数" class="headerlink" title="ast语法变为render函数"></a>ast语法变为render函数</h5><p>配合上面使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&lt;div id=&quot;app&quot;&gt;hello &#123;&#123;msg&#125;&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="comment">render()&#123;</span></span><br><span class="line"><span class="comment">  return _c(&#x27;div&#x27;,&#123;id:app&#125;,_v(&#x27;hello&#x27;+_s(msg)),_c)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> defaultTagRE = <span class="regexp">/\&#123;((?:.|\r?\n)+?)\&#125;\&#125;/g</span></span><br><span class="line"><span class="comment">//处理属性</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genPorps</span>(<span class="params">attrs</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> str =<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i =<span class="number">0</span>;i&lt;attrs.<span class="property">length</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">let</span> attr = attr[i];</span><br><span class="line">        <span class="keyword">if</span>(attr.<span class="property">name</span> == <span class="string">&#x27;style&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line">            <span class="comment">// let [key,val] = sttr.value.split(&#x27;;&#x27;)</span></span><br><span class="line">            attr.<span class="property">vale</span>.<span class="title function_">split</span>(<span class="string">&#x27;;&#x27;</span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">item</span>=&gt;</span>&#123;</span><br><span class="line">                <span class="keyword">let</span> [key,val] =item.<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>) </span><br><span class="line">                obj[key] = val</span><br><span class="line">            &#125;)</span><br><span class="line">            attr.<span class="property">value</span> = obj</span><br><span class="line">        &#125;</span><br><span class="line">        str+= <span class="string">`<span class="subst">$&#123;attr.name&#125;</span>:<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(attr.value)&#125;</span>`</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`&#123;<span class="subst">$&#123;str.slice(<span class="number">0</span>,-<span class="number">1</span>)&#125;</span>&#125;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理子节点</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">genChildren</span>(<span class="params">el</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> children = el.<span class="property">children</span></span><br><span class="line">    <span class="keyword">if</span>(children)&#123;</span><br><span class="line">        <span class="keyword">return</span> children.<span class="title function_">map</span>(<span class="function"><span class="params">child</span>=&gt;</span><span class="title function_">gen</span>(child)).<span class="title function_">join</span>(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">gen</span>(<span class="params">node</span>)&#123;</span><br><span class="line">    <span class="comment">//形式  1.元素  2.div  3.文本</span></span><br><span class="line">    <span class="keyword">if</span>(node.<span class="property">type</span> === <span class="number">1</span>)&#123;  <span class="comment">//元素</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">generate</span>(node)</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;<span class="comment">//文本  (1)只是文本  不带插值表达式  （2）插值表达式特殊处理</span></span><br><span class="line">       <span class="keyword">let</span> text = node.<span class="property">text</span>  <span class="comment">//获取文本</span></span><br><span class="line">       <span class="keyword">if</span>(!defaultTagRE.<span class="title function_">test</span>(text))&#123;<span class="comment">//检测是否有插值表达式</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">`_v(<span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(text)&#125;</span>）`</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//带有插值表达式</span></span><br><span class="line">       <span class="keyword">let</span> tokens = []</span><br><span class="line">       <span class="keyword">let</span> lastindex = defaultTagRE.<span class="property">lasteIndex</span> = <span class="number">0</span></span><br><span class="line">       <span class="keyword">let</span> match </span><br><span class="line">       <span class="keyword">while</span>(match = defaultTagRE.<span class="title function_">exec</span>(text))&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> index = match.<span class="property">index</span></span><br><span class="line">        <span class="keyword">if</span>(index&gt;lastindex)&#123;<span class="comment">//添加内容</span></span><br><span class="line">          tokens.<span class="title function_">push</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(text.<span class="title function_">slice</span>(lastindex,index)))</span><br><span class="line">        &#125;</span><br><span class="line">        tokens.<span class="title function_">push</span>(<span class="string">`_s(<span class="subst">$&#123;match[<span class="number">1</span>].trim()&#125;</span>)`</span>)</span><br><span class="line">        lastindex = index+ match[<span class="number">0</span>].<span class="property">length</span></span><br><span class="line">        <span class="keyword">if</span>(lastindex&lt;text.<span class="property">length</span>)&#123;</span><br><span class="line">            tokens.<span class="title function_">push</span>(<span class="title class_">JSON</span>.<span class="title function_">sttingify</span>(text.<span class="title function_">slice</span>(lastindex)))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`_v(<span class="subst">$&#123;tokens.join(<span class="string">&#x27;+&#x27;</span>)&#125;</span>)`</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">generate</span>(<span class="params">el</span>)&#123;</span><br><span class="line">    <span class="comment">//注意属性  &#123;id:app,style:&#123;color:red&#125;&#125;</span></span><br><span class="line">    <span class="keyword">let</span> children = <span class="title function_">genChildren</span>(el)</span><br><span class="line">    <span class="keyword">let</span> code = <span class="string">`_c(<span class="subst">$&#123;el.tag&#125;</span>,<span class="subst">$&#123;el.attrs.length?<span class="string">`<span class="subst">$&#123;genPorps(el.attrs)&#125;</span>`</span>:<span class="string">&#x27;null&#x27;</span>&#125;</span>,<span class="subst">$&#123;children?<span class="string">`<span class="subst">$&#123;children&#125;</span>`</span>:<span class="string">&#x27;null&#x27;</span>&#125;</span>)`</span></span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="render字符串从函数到dom"><a href="#render字符串从函数到dom" class="headerlink" title="render字符串从函数到dom"></a>render字符串从函数到dom</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 变为ast  语法树</span></span><br><span class="line"><span class="keyword">let</span> ast = <span class="title function_">parseHTML</span>(el)</span><br><span class="line"><span class="comment">//  2.ast语法树变为render函数</span></span><br><span class="line"><span class="keyword">let</span> code =  <span class="title function_">generate</span>(ast)</span><br><span class="line"><span class="comment">//3.将render字符串变成函数</span></span><br><span class="line"><span class="keyword">let</span> render  = <span class="keyword">new</span> <span class="title class_">Function</span>(<span class="string">`with(this)&#123;return <span class="subst">$&#123;code&#125;</span>&#125;`</span>)</span><br><span class="line"><span class="comment">//将render函数变成vnode(虚拟dom)</span></span><br><span class="line"> <span class="keyword">return</span> render</span><br><span class="line"></span><br><span class="line"> <span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">mountComponent</span>(<span class="params">vm,el</span>)&#123;</span><br><span class="line">    <span class="title function_">callHook</span>(vm,<span class="string">&#x27;beforMounted&#x27;</span>)</span><br><span class="line">    vm.<span class="title function_">_updata</span>(vm.<span class="title function_">_render</span>()) <span class="comment">//（1）vm._render  将render函数转为vnode  （2）vm._updata将vnode转为真实dom</span></span><br><span class="line">     <span class="title function_">callHook</span>(vm,<span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//生命周期</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">lifeyvleMinin</span>(<span class="params">vue</span>)&#123;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_updata</span> = <span class="keyword">function</span>(<span class="params">vnode</span>)&#123;</span><br><span class="line">        <span class="keyword">let</span> vm = <span class="variable language_">this</span></span><br><span class="line">        <span class="comment">//两个参数    旧dom  新dom</span></span><br><span class="line">       vm.<span class="property">$el</span>=<span class="title function_">patch</span>(vm.<span class="property">$el</span>,vnode)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//生命周期调用</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">callHook</span>(<span class="params">vm,hook</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> handlers = vm.<span class="property">$options</span>[hook]</span><br><span class="line">    <span class="keyword">if</span>(handlers)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;headers.<span class="property">length</span>;i++)&#123;</span><br><span class="line">            handlers[i].<span class="title function_">call</span>(<span class="variable language_">this</span>)   <span class="comment">//改变生命周期中this</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">renderMin</span>(<span class="params">Vue</span>)&#123;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_c</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="comment">//处理标签</span></span><br><span class="line">       <span class="comment">//  创建标签</span></span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">createElement</span>(...<span class="variable language_">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_v</span> = <span class="keyword">function</span>(<span class="params">text</span>)&#123;<span class="comment">//处理文本</span></span><br><span class="line">       <span class="keyword">return</span> <span class="title function_">createText</span>(text)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_s</span> = <span class="keyword">function</span>(<span class="params">value</span>)&#123;<span class="comment">//处理变量</span></span><br><span class="line">      <span class="keyword">return</span> val == <span class="literal">null</span> ? <span class="string">&quot;&quot;</span>:(<span class="keyword">typeof</span> val == <span class="string">&#x27;object&#x27;</span>)?<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(val):val</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title class_">Vue</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">_render</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line"> <span class="comment">//render函数变成vnode</span></span><br><span class="line">   <span class="keyword">let</span> vm =<span class="variable language_">this</span> <span class="comment">//实例</span></span><br><span class="line">    <span class="keyword">let</span> render = vm.<span class="property">$options</span>.<span class="property">render</span></span><br><span class="line">    <span class="keyword">let</span> vnode = = render.<span class="title function_">call</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建元素</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span>(<span class="params">tag,data = &#123;&#125;,...children</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(tag,data,data.<span class="property">key</span>,children)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//创建文本</span></span><br><span class="line"><span class="keyword">function</span>  <span class="title function_">createText</span>(<span class="params">text</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">vnode</span>(<span class="literal">undefined</span>,<span class="literal">undefined</span>,<span class="literal">undefined</span>,<span class="literal">undefined</span>,text)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 创建虚拟dom</span></span><br><span class="line"> <span class="keyword">function</span> <span class="title function_">vnode</span>(<span class="params">tag,data,key,children,text</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">       tag,</span><br><span class="line">       data,</span><br><span class="line">       key,</span><br><span class="line">       children,</span><br><span class="line">       text</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">patch</span>(<span class="params">oldVnode,vnode</span>)&#123;</span><br><span class="line">    <span class="comment">//vnode =&gt;  真实dom</span></span><br><span class="line">    <span class="comment">//(1)  创建新dom</span></span><br><span class="line">    <span class="keyword">let</span> el = <span class="title function_">createEl</span>(vnode)</span><br><span class="line">    <span class="comment">//(2)替换  获取父节点    插入    删除</span></span><br><span class="line">    <span class="keyword">let</span> parentEl = oldVnode.<span class="property">parentNode</span>  <span class="comment">//body</span></span><br><span class="line">    parentEl.<span class="title function_">insertBefore</span>(el,oldVnode.<span class="property">nextsibling</span>)</span><br><span class="line">    parentEl.<span class="title function_">removeChild</span>(oldVnode)</span><br><span class="line">    <span class="keyword">return</span> el</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createEl</span>(<span class="params">vnode</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;tag,children,key,data,text&#125; = vnode</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> tag == <span class="string">&#x27;string&#x27;</span>)&#123;<span class="comment">//表示tag是一个元素</span></span><br><span class="line">        vnode.<span class="property">el</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag)<span class="comment">//创建元素</span></span><br><span class="line">        <span class="keyword">if</span>(children.<span class="property">length</span>&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            children.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span>=&gt;</span>&#123;</span><br><span class="line">                 vnode.<span class="property">el</span>.<span class="title function_">appendChild</span>(<span class="title function_">createEl</span>(child))</span><br><span class="line">            &#125;)</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        vnode.<span class="property">el</span> = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(text)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vnode.<span class="property">el</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//render()函数=&gt;vnode=&gt;真是的dom</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">//vnode  节点</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">    tag,  标签</span></span><br><span class="line"><span class="comment">    text,  文本</span></span><br><span class="line"><span class="comment">    children  子级</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">//vue的渲染流程=&gt;数据初始化=&gt;对模块进行编译=&gt;变成rednder函数=&gt;ender函数 变成vnode =&gt;变成真实dom</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>  vue源码后续待更新</p>
<h3 id="diff算法"><a href="#diff算法" class="headerlink" title="diff算法"></a>diff算法</h3><p>diff 算法是一种通过同层的树节点进行比较的高效算法，比较只会在同层级进行, 不会跨层级比较 在diff比较的过程中，循环从两边向中间比较<br>原理：当数据发生改变时，set方法会调用Dep.notify通知所有订阅者Watcher，订阅者就会调用patch给真实的DOM打补丁，更新相应的视图<br>通过isSameVnode进行判断，相同则调用patchVnode方法<br>patchVnode做了以下操作：<br>找到对应的真实dom，称为el<br>如果都有都有文本节点且不相等，将el文本节点设置为Vnode的文本节点<br>如果oldVnode有子节点而VNode没有，则删除el子节点<br>如果oldVnode没有子节点而VNode有，则将VNode的子节点真实化后添加到el<br>如果两者都有子节点，则执行updateChildren函数比较子节点<br>updateChildren主要做了以下操作：<br>设置新旧VNode的头尾指针<br>新旧头尾指针进行比较，循环向中间靠拢，根据情况调用patchVnode进行patch重复流程、调用createElem创建一个新节点，从哈希表寻找 key一致的VNode 节点再分情况操作</p>
<h3 id="vue中的双向数据绑定"><a href="#vue中的双向数据绑定" class="headerlink" title="vue中的双向数据绑定"></a>vue中的双向数据绑定</h3><p>new Vue()首先执行初始化，在Observe函数中对data执行响应化处理，同时对模板执行编译，找到其中动态绑定的数据，从data中获取并初始化视图，同时定义⼀个更新函数和Watcher，将来对应数据变化时Watcher会调用更新函数 因为datra中的某个属性会多次出现  定义了一个dep  管理watcher   将来data中数据⼀旦发生变化，会首先找到对应的Dep，通知所有Watcher执行更新函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> &#123;  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$options</span> = options;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$data</span> = options.<span class="property">data</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对data选项做响应式处理  </span></span><br><span class="line">    <span class="title function_">observe</span>(<span class="variable language_">this</span>.<span class="property">$data</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 代理data到vm上  </span></span><br><span class="line">    <span class="title function_">proxy</span>(<span class="variable language_">this</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行编译  </span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Compile</span>(options.<span class="property">el</span>, <span class="variable language_">this</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">observe</span>(<span class="params">obj</span>) &#123;  </span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> obj !== <span class="string">&quot;object&quot;</span> || obj == <span class="literal">null</span>) &#123;  </span><br><span class="line">    <span class="keyword">return</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Observer</span>(obj);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = value;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">walk</span>(value);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="title function_">walk</span>(<span class="params">obj</span>) &#123;  </span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(obj).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;  </span><br><span class="line">      <span class="title function_">defineReactive</span>(obj, key, obj[key]);  </span><br><span class="line">    &#125;);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Compile</span> &#123;  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">el, vm</span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$vm</span> = vm;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">$el</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(el);  <span class="comment">// 获取dom  </span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">$el</span>) &#123;  </span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">compile</span>(<span class="variable language_">this</span>.<span class="property">$el</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="title function_">compile</span>(<span class="params">el</span>) &#123;  </span><br><span class="line">    <span class="keyword">const</span> childNodes = el.<span class="property">childNodes</span>;   </span><br><span class="line">    <span class="title class_">Array</span>.<span class="title function_">from</span>(childNodes).<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123; <span class="comment">// 遍历子元素  </span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isElement</span>(node)) &#123;   <span class="comment">// 判断是否为节点  </span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;编译元素&quot;</span> + node.<span class="property">nodeName</span>);  </span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isInterpolation</span>(node)) &#123;  </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;编译插值⽂本&quot;</span> + node.<span class="property">textContent</span>);  <span class="comment">// 判断是否为插值文本 &#123;&#123;&#125;&#125;  </span></span><br><span class="line">      &#125;  </span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">childNodes</span> &amp;&amp; node.<span class="property">childNodes</span>.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;  <span class="comment">// 判断是否有子元素  </span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">compile</span>(node);  <span class="comment">// 对子元素进行递归遍历  </span></span><br><span class="line">      &#125;  </span><br><span class="line">    &#125;);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="title function_">isElement</span>(<span class="params">node</span>) &#123;  </span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> == <span class="number">1</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="title function_">isInterpolation</span>(<span class="params">node</span>) &#123;  </span><br><span class="line">    <span class="keyword">return</span> node.<span class="property">nodeType</span> == <span class="number">3</span> &amp;&amp; <span class="regexp">/\&#123;\&#123;(.*)\&#125;\&#125;/</span>.<span class="title function_">test</span>(node.<span class="property">textContent</span>);  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="comment">// 负责更新视图  </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm, key, updater</span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span> = vm  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">key</span> = key  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">updaterFn</span> = updater  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建实例时，把当前实例指定到Dep.target静态属性上  </span></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>  </span><br><span class="line">    <span class="comment">// 读一下key，触发get  </span></span><br><span class="line">    vm[key]  </span><br><span class="line">    <span class="comment">// 置空  </span></span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>  </span><br><span class="line">  &#125;  </span><br><span class="line"></span><br><span class="line">  <span class="comment">// 未来执行dom更新函数，由dep调用的  </span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params"></span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">updaterFn</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>.<span class="property">vm</span>, <span class="variable language_">this</span>.<span class="property">vm</span>[<span class="variable language_">this</span>.<span class="property">key</span>])  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dep</span> &#123;  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span> = [];  <span class="comment">// 依赖管理  </span></span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="title function_">addDep</span>(<span class="params">dep</span>) &#123;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="title function_">push</span>(dep);  </span><br><span class="line">  &#125;  </span><br><span class="line">  <span class="title function_">notify</span>(<span class="params"></span>) &#123;   </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">deps</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">dep</span>) =&gt;</span> dep.<span class="title function_">update</span>());  </span><br><span class="line">  &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Watcher</span> &#123;  </span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">vm, key, updateFn</span>) &#123;  </span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="variable language_">this</span>;  </span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vm</span>[<span class="variable language_">this</span>.<span class="property">key</span>];  </span><br><span class="line">    <span class="title class_">Dep</span>.<span class="property">target</span> = <span class="literal">null</span>;  </span><br><span class="line">  &#125;  </span><br><span class="line">  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">defineReactive</span>(<span class="params">obj, key, val</span>) &#123;  </span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">observe</span>(val);  </span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> <span class="title class_">Dep</span>();  </span><br><span class="line">  <span class="title class_">Object</span>.<span class="title function_">defineProperty</span>(obj, key, &#123;  </span><br><span class="line">    <span class="title function_">get</span>(<span class="params"></span>) &#123;  </span><br><span class="line">      <span class="title class_">Dep</span>.<span class="property">target</span> &amp;&amp; dep.<span class="title function_">addDep</span>(<span class="title class_">Dep</span>.<span class="property">target</span>);<span class="comment">// Dep.target也就是Watcher实例  </span></span><br><span class="line">      <span class="keyword">return</span> val;  </span><br><span class="line">    &#125;,  </span><br><span class="line">    <span class="title function_">set</span>(<span class="params">newVal</span>) &#123;  </span><br><span class="line">      <span class="keyword">if</span> (newVal === val) <span class="keyword">return</span>;  </span><br><span class="line">      dep.<span class="title function_">notify</span>(); <span class="comment">// 通知dep执行更新方法  </span></span><br><span class="line">    &#125;,  </span><br><span class="line">  &#125;);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<h3 id="js运行机制"><a href="#js运行机制" class="headerlink" title="js运行机制"></a>js运行机制</h3><p>javaScript语言的一大特点就是单线程，也就是说，同一个时间只能做一件事<br>avaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。<br>事件循环是js实现异步的一种方法，也是js的执行机制。<br>javascript的执行和运行<br>执行和运行有很大的区别，javascript在不同的环境下，比如node，浏览器，Ringo等等，执行方式是不同的。而运行大多指javascript解析引擎，是统一的。<br>js 轮询机制<br>所有任务都在主线程上执行，形成一个执行栈。<br>2、主线程发现有异步任务，如果是微任务就把他放到微任务的消息队列里，如果是宏任务就把他<br>放到宏任务的消息队列里。<br>3、执行栈所有同步任务执行完毕。<br>4、执行微任务队列，之后再执行宏任务队列。</p>
<h3 id="浏览器跨域原理"><a href="#浏览器跨域原理" class="headerlink" title="浏览器跨域原理"></a>浏览器跨域原理</h3><p>核心思想：浏览器的script、img、iframe标签是不受同源策略限制的，所以通过script标签引入一个js文件，这个js文件载入成功后会执行我们在url参数中指定的callback函数，并把我们需要的json数据作为参数传入。在服务器端，当req.params参数中带有callback属性时，则把数据作为callback的参数执行，并拼接成一个字符串后返回。<br>优点：兼容性好，简单易用，支持浏览器与服务器双向通信<br>缺点：只支持GET请求，且只支持跨域HTTP请求这种情况（不支持HTTPS）<br>在js中，直接用XMLHttpRequest请求不同域上的数据时，是不可以的。但在页面上引入不同域上的js脚本文件却是可以的，jsonp正是利用这个特性来实现的。</p>
<p>CORS请求原理<br>CORS是一个W3C标准，全称是”跨域资源共享”（Cross-origin resource sharing）。它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。</p>
<p>核心思想：在服务器端通过检查请求头部的origin，从而决定请求应该成功还是失败<br>修改document.domain来跨子域<br>浏览器都有一个同源策略，限制其一：不能通过ajax的方法去请求不同源中的文档； 其二：浏览器中不同域的框架间不能进行js的交互操作。<br>不同的框架之间（父子或同辈），能够获取到彼此的window对象的，但不能使用获取到的window对象的属性和方法(html5中的postMessage方法是一个例外，还有些浏览器如ie6也可以使用top、parent等少数几个属性)。</p>
<h3 id="实用方法"><a href="#实用方法" class="headerlink" title="实用方法"></a>实用方法</h3><h4 id="复制文本到切板"><a href="#复制文本到切板" class="headerlink" title="复制文本到切板"></a>复制文本到切板</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">copy</span>= (<span class="params">text</span>)=&gt;navigator.<span class="property">clipboard</span>.<span class="title function_">writeText</span>(text)</span><br><span class="line">   <span class="title function_">copy</span>(<span class="string">&quot;你好&quot;</span>)   </span><br></pre></td></tr></table></figure>

<h4 id="获取某个日期相当于当年的第几天"><a href="#获取某个日期相当于当年的第几天" class="headerlink" title="获取某个日期相当于当年的第几天"></a>获取某个日期相当于当年的第几天</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">time</span> = (<span class="params">date</span>)=&gt;<span class="title class_">Math</span>.<span class="title function_">floor</span>((date - <span class="keyword">new</span> <span class="title class_">Date</span>(date.<span class="title function_">getFullYear</span>(),<span class="number">0</span>,<span class="number">0</span>))/<span class="number">100.</span>/<span class="number">60</span>/<span class="number">60</span>/<span class="number">24</span>)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">time</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">2023</span>,<span class="number">12</span>,<span class="number">30</span>))</span><br></pre></td></tr></table></figure>
<h4 id="解析url参数"><a href="#解析url参数" class="headerlink" title="解析url参数"></a>解析url参数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">parseurl</span> = (<span class="params">url</span>)=&gt;&#123;</span><br><span class="line">       q=&#123;&#125;</span><br><span class="line">       url.<span class="title function_">replace</span>(<span class="regexp">/([^?&amp;=]+)=([^&amp;+])/g</span>,<span class="function">(<span class="params">_,k,v</span>)=&gt;</span>(q[k]=v))</span><br><span class="line">       <span class="keyword">return</span> q</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">parseurl</span>(<span class="string">&quot;http://a.com/?a=1&amp;b=2&quot;</span>))</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">parseurl</span>(<span class="string">&quot;a=1&amp;b=2&quot;</span>));</span><br></pre></td></tr></table></figure>
<h4 id="生成随机颜色"><a href="#生成随机颜色" class="headerlink" title="生成随机颜色"></a>生成随机颜色</h4>  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">color</span> = (<span class="params"></span>) =&gt; <span class="string">&#x27;#&#x27;</span>+<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * <span class="number">0xffffff</span>).<span class="title function_">toString</span>(<span class="number">16</span>).<span class="title function_">padEnd</span>(<span class="number">6</span>,<span class="string">&#x27;0&#x27;</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">color</span>());</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="去掉字符串中的元素标记"><a href="#去掉字符串中的元素标记" class="headerlink" title="去掉字符串中的元素标记"></a>去掉字符串中的元素标记</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">removetap</span> = (<span class="params">tag</span>) =&gt; <span class="keyword">new</span> <span class="title class_">DOMParser</span>().<span class="title function_">parseFromString</span>(tag,<span class="string">&#x27;text/html&#x27;</span>).<span class="property">body</span>.<span class="property">textContent</span> || <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">removetap</span>(<span class="string">&quot;&lt;div&gt;55555555&lt;/div&gt;&quot;</span>))   <span class="comment">// </span></span><br><span class="line"><span class="string">``</span><span class="string">`    </span></span><br><span class="line"><span class="string">#### 获取对象的基本数据类型</span></span><br><span class="line"><span class="string"> `</span><span class="string">``</span>js</span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">getType</span> = (<span class="params">tag</span>) =&gt; &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span>.<span class="title function_">call</span>(tag).<span class="title function_">slice</span>(<span class="number">8</span>,-<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">getType</span>(<span class="function">()=&gt;</span>&#123;&#125;));</span><br></pre></td></tr></table></figure>

<h4 id="反转字符串"><a href="#反转字符串" class="headerlink" title="反转字符串"></a>反转字符串</h4> <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">reverString</span> = (<span class="params">str</span>) =&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>).<span class="title function_">reverse</span>().<span class="title function_">join</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">reverString</span>(<span class="string">&quot;efesgfrgrd&quot;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="获取两个数字之间的随机数"><a href="#获取两个数字之间的随机数" class="headerlink" title="获取两个数字之间的随机数"></a>获取两个数字之间的随机数</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">random</span> =(<span class="params">min,max</span>)=&gt;&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * (max-min+<span class="number">1</span>)+min)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">random</span>(<span class="number">5</span>,<span class="number">8</span>))</span><br></pre></td></tr></table></figure>
<h4 id="检查日期是否合法"><a href="#检查日期是否合法" class="headerlink" title="检查日期是否合法"></a>检查日期是否合法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ifTimeDate</span> = (<span class="params">...time</span>) =&gt;&#123;</span><br><span class="line">       <span class="keyword">return</span> !<span class="title class_">Number</span>.<span class="built_in">isNaN</span>(<span class="keyword">new</span> <span class="title class_">Date</span>(...time).<span class="title function_">valueOf</span>())</span><br><span class="line">   &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">ifTimeDate</span>(<span class="string">&quot; 1999 03:16:18&quot;</span>));</span><br></pre></td></tr></table></figure>
<h4 id="检查日期是否在两个日期之间"><a href="#检查日期是否在两个日期之间" class="headerlink" title="检查日期是否在两个日期之间"></a>检查日期是否在两个日期之间</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">ifData</span> = (<span class="params">data,min,max</span>)=&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> +max&gt;= +data &amp;&amp; data &gt;= +min</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> data = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2010-12-8&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> min = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2003-05-6&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> max = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;2008-05-16&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">ifData</span>(data,min,max))</span><br></pre></td></tr></table></figure>
<h4 id="判断此页面标签是否激活"><a href="#判断此页面标签是否激活" class="headerlink" title="判断此页面标签是否激活"></a>判断此页面标签是否激活</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isTabView</span> =(<span class="params"></span>)=&gt;!<span class="variable language_">document</span>.<span class="property">hidden</span></span><br><span class="line"><span class="title function_">isTabView</span>()</span><br></pre></td></tr></table></figure>
<h4 id="判断一段字符串是否是url"><a href="#判断一段字符串是否是url" class="headerlink" title="判断一段字符串是否是url"></a>判断一段字符串是否是url</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isUrl</span> = (<span class="params">url</span>) =&gt;&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="regexp">/^(http|https):\/\/([\w.]+\/?)\S*/</span>.<span class="title function_">test</span>(url)</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">isUrl</span>(<span class="string">&quot;http://baidu.com&quot;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="打乱数组顺序"><a href="#打乱数组顺序" class="headerlink" title="打乱数组顺序"></a>打乱数组顺序</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">arr = arr.<span class="title function_">sort</span>(<span class="function">()=&gt;</span><span class="number">0.5</span> - <span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr);</span><br></pre></td></tr></table></figure>
<h4 id="去除数字之外的所有字符"><a href="#去除数字之外的所有字符" class="headerlink" title="去除数字之外的所有字符"></a>去除数字之外的所有字符</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> str = <span class="string">&quot;5415sfs5f15sdf48sdf5ds6666666668ss5ds88&quot;</span></span><br><span class="line"><span class="keyword">const</span> number = str.<span class="title function_">replace</span>(<span class="regexp">/\D/g</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(number);</span><br></pre></td></tr></table></figure>
<h4 id="删除数组重复项"><a href="#删除数组重复项" class="headerlink" title="删除数组重复项"></a>删除数组重复项</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">8</span>]</span><br><span class="line"><span class="keyword">const</span>  <span class="title function_">arr2</span>= (<span class="params">arr</span>)=&gt;[...<span class="keyword">new</span> <span class="title class_">Set</span>(arr)]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">arr2</span>(arr));</span><br></pre></td></tr></table></figure>
<h4 id="过滤数组为false得值"><a href="#过滤数组为false得值" class="headerlink" title="过滤数组为false得值"></a>过滤数组为false得值</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="string">&#x27;undefined&#x27;</span>,<span class="number">0</span>,<span class="number">2</span>,<span class="literal">false</span>]</span><br><span class="line"><span class="keyword">const</span> arr2 = arr.<span class="title function_">filter</span>(<span class="title class_">Boolean</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr2);</span><br></pre></td></tr></table></figure>
<h4 id="滚动到页面顶部"><a href="#滚动到页面顶部" class="headerlink" title="滚动到页面顶部"></a>滚动到页面顶部</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">scrllToTop</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(&#123;<span class="attr">top</span>:<span class="number">0</span>,<span class="attr">left</span>:<span class="number">0</span>,<span class="attr">behavior</span>:<span class="string">&quot;smooth&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="滚动到页面底部"><a href="#滚动到页面底部" class="headerlink" title="滚动到页面底部"></a>滚动到页面底部</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">scrllToTop</span> = (<span class="params"></span>) =&gt;&#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">scrollTo</span>(&#123;<span class="attr">top</span>:<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">offsetHeight</span>,<span class="attr">left</span>:<span class="number">0</span>,<span class="attr">behavior</span>:<span class="string">&quot;smooth&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="调用摄像头"><a href="#调用摄像头" class="headerlink" title="调用摄像头"></a>调用摄像头</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn_start&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">       navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;<span class="attr">video</span>:<span class="literal">true</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">stream</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;video&quot;</span>).<span class="property">srcObject</span> = stream</span><br><span class="line">       &#125;)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h4 id="y隐藏手机号中间四位"><a href="#y隐藏手机号中间四位" class="headerlink" title="y隐藏手机号中间四位"></a>y隐藏手机号中间四位</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> tel = <span class="string">&#x27;15237903806&#x27;</span></span><br><span class="line"><span class="keyword">const</span> reg = <span class="regexp">/^(\d&#123;3&#125;)\d&#123;4&#125;(\d&#123;4&#125;)$/</span></span><br><span class="line"><span class="keyword">const</span> str = tel.<span class="title function_">replace</span>(reg,<span class="string">&quot;$1****$2&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(str)</span><br></pre></td></tr></table></figure>

<h4 id="禁止浏览器缩放"><a href="#禁止浏览器缩放" class="headerlink" title="禁止浏览器缩放"></a>禁止浏览器缩放</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">      <span class="string">&quot;mousewheel&quot;</span>,</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.<span class="property">ctrlKey</span> === <span class="literal">true</span> || event.<span class="property">metaKey</span>) &#123;</span><br><span class="line">          event.<span class="title function_">preventDefault</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//firefox</span></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">      <span class="string">&quot;DOMMouseScroll&quot;</span>,</span><br><span class="line">      <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (event.<span class="property">ctrlKey</span> === <span class="literal">true</span> || event.<span class="property">metaKey</span>) &#123;</span><br><span class="line">          event.<span class="title function_">preventDefault</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; <span class="attr">passive</span>: <span class="literal">false</span> &#125;</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<h4 id="vue自定义拖拽指令"><a href="#vue自定义拖拽指令" class="headerlink" title="vue自定义拖拽指令"></a>vue自定义拖拽指令</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">directive</span>(<span class="string">&#x27;drag&#x27;</span>, <span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> oDiv = el <span class="comment">// 当前元素</span></span><br><span class="line">  <span class="keyword">const</span> minTop = oDiv.<span class="title function_">getAttribute</span>(<span class="string">&#x27;drag-min-top&#x27;</span>)  <span class="comment">//用以获取HTML元素的属性</span></span><br><span class="line">  <span class="keyword">const</span> ifMoveSizeArea = <span class="number">20</span></span><br><span class="line">  oDiv.<span class="property">onmousedown</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> target = oDiv</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable language_">window</span>.<span class="title function_">getComputedStyle</span>(target).<span class="property">position</span> !== <span class="string">&#x27;absolute&#x27;</span> &amp;&amp; target !== <span class="variable language_">document</span>.<span class="property">body</span>) &#123;</span><br><span class="line">      target = target.<span class="property">parentElement</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">onselectstart</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!target.<span class="title function_">getAttribute</span>(<span class="string">&#x27;init_x&#x27;</span>)) &#123;</span><br><span class="line">      target.<span class="title function_">setAttribute</span>(<span class="string">&#x27;init_x&#x27;</span>, target.<span class="property">offsetLeft</span>)</span><br><span class="line">      target.<span class="title function_">setAttribute</span>(<span class="string">&#x27;init_y&#x27;</span>, target.<span class="property">offsetTop</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> initX = <span class="built_in">parseInt</span>(target.<span class="title function_">getAttribute</span>(<span class="string">&#x27;init_x&#x27;</span>))</span><br><span class="line">    <span class="keyword">const</span> initY = <span class="built_in">parseInt</span>(target.<span class="title function_">getAttribute</span>(<span class="string">&#x27;init_y&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 鼠标按下，计算当前元素距离可视区的距离</span></span><br><span class="line">    <span class="keyword">const</span> disX = e.<span class="property">clientX</span> - target.<span class="property">offsetLeft</span></span><br><span class="line">    <span class="keyword">const</span> disY = e.<span class="property">clientY</span> - target.<span class="property">offsetTop</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 通过事件委托，计算移动的距离</span></span><br><span class="line">      <span class="comment">// 因为浏览器里并不能直接取到并且使用clientX、clientY,所以使用事件委托在内部做完赋值</span></span><br><span class="line">      <span class="keyword">const</span> l = e.<span class="property">clientX</span> - disX</span><br><span class="line">      <span class="keyword">const</span> t = e.<span class="property">clientY</span> - disY</span><br><span class="line">      <span class="comment">// 计算移动当前元素的位置，并且给该元素样式中的left和top值赋值</span></span><br><span class="line">      target.<span class="property">style</span>.<span class="property">left</span> = l + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">      target.<span class="property">style</span>.<span class="property">top</span> = (t &lt; minTop ? minTop : t) + <span class="string">&#x27;px&#x27;</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(l - initX) &gt; ifMoveSizeArea || <span class="title class_">Math</span>.<span class="title function_">abs</span>(t - initY) &gt; ifMoveSizeArea) &#123;</span><br><span class="line">        target.<span class="title function_">setAttribute</span>(<span class="string">&#x27;dragged&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        target.<span class="title function_">removeAttribute</span>(<span class="string">&#x27;dragged&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onmousemove</span> = <span class="literal">null</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onmouseup</span> = <span class="literal">null</span></span><br><span class="line">      <span class="variable language_">document</span>.<span class="property">onselectstart</span> = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// return false不加的话可能导致黏连，拖到一个地方时div粘在鼠标上不下来，相当于onmouseup失效</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="调用摄像头-1"><a href="#调用摄像头-1" class="headerlink" title="调用摄像头"></a>调用摄像头</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;btn_start&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">      navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123;<span class="attr">video</span>:<span class="literal">true</span>&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">stream</span>=&gt;</span>&#123;</span><br><span class="line">       <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;video&quot;</span>).<span class="property">srcObject</span> = stream</span><br><span class="line">      &#125;)</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>
</article>
    
    <div class="trm-reward">
        
            <span class="trm-reward-btn trm-glow" onclick='var qr = document.getElementById("qr"); qr.style.display = (qr.style.display === "none") ? "block" : "none";'>
                <i class="iconfont fas fa-hand-holding-usd"></i>
            </span>
        
        <p class="trm-reward-comment">觉得写的不错  就可怜可怜博主吧.</p>
        <div id="qr" style="display:none;">
            
                <div style="display:inline-block">
                    <a rel="noopener noreferrer" href='http://www.hetao.asia/image/ewm.png' target='_blank' >
                       <img src="http://www.hetao.asia/image/ewm.png" alt="微信支付" loading="lazy">
                    </a>
                    <p>微信支付</p>
                </div>
            
        </div>
    </div>

    
</div>
<div id="post-next-prev" class="row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            其他文章
            <span data-number="02"></span>
        </h5>
    </div>
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation" data-scroll data-scroll-offset="40">
        <a href="/2021/10/19/Nuxt/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/../image/nuxtjs.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" #.">
                    未分类
                </a>
            </div>
            <h5>
                <a href="/2021/10/19/Nuxt/" class="trm-anima-link">
                    Nuxtjs学习
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>21/10/19</li>
                <li>10:20</li>
                
                    <li>1.2k</li>
                
                
                    <li>4</li>
                
            </ul>
        </div>
    </div>
</div>
    
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation" data-scroll data-scroll-offset="40">
        <a href="/2021/09/15/vue/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/../image/vue.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" #.">
                    未分类
                </a>
            </div>
            <h5>
                <a href="/2021/09/15/vue/" class="trm-anima-link">
                    vue2内容
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>21/09/15</li>
                <li>10:46</li>
                
                    <li>15.1k</li>
                
                
                    <li>70</li>
                
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-scroll-animation" data-scroll data-scroll-offset="50">

    

    
        <div class="trm-footer-item">
            <span>© 2020- 2023</span>
            <span class="footer-separator"data-separator=" · "></span>
            <span class="trm-accent-color">周子谦的博客</span>
        </div>
    

      

     

     
</footer>
 
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            <div class="trm-fixed-container" data-scroll data-scroll-sticky data-scroll-target=".locomotive-scroll__sticky-target" data-scroll-offset="-10">
    
        <div class="trm-fixed-btn" data-title="阅读模式" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="回到顶部">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
          </div>
        </div>
      </div>
      <!-- scroll container end -->

  </div>
  <!-- app wrapper end -->

  
<div class="trm-search-popup">
    <div class="trm-search-header">
        <span class="trm-search-popup-btn-close">
            <i class="iconfont fas fa-times"></i>
        </span>
    </div>
    <div class="form trm-search-form">
        <input class="trm-search-input" type="text" placeholder="搜索...">
    </div>
    <div class="trm-search-result-container">

    </div>
</div>

  <!-- Plugin -->




    
    
<script src="https://unpkg.com/locomotive-scroll@4.1.4/dist/locomotive-scroll.min.js"></script>

    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    

    
        
<script src="https://unpkg.com/hexo-generator-searchdb@1.4.0/dist/search.js"></script>

        <script src="/js/plugins/local_search.js?v=2.0.4"></script>
    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    



<!-- CDN -->


    

    

    




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/js/main.js?v=2.0.4"></script>

</body>

</html>